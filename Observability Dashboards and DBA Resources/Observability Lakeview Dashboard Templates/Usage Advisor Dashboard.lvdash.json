{"datasets":[{"name":"a4ec3948","displayName":"Billing Timeline","query":"-- Need to get owner of usage\n-- Job\n-- Pipeline, cluster, warehouse\n\nWITH compute AS (\nSELECT\n  c.cluster_name,\n  CASE\n    WHEN c.cluster_name LIKE 'job-%' THEN 'Job Cluster'\n    WHEN c.cluster_name LIKE 'dlt-%' THEN 'DLT Pipeline'\n    ELSE 'Adhoc Cluster'\n  END AS cluster_type,\n  CASE\n    WHEN c.cluster_name LIKE 'job-%' THEN regexp_extract(c.cluster_name, '^job-(\\\\d+)-')\n    WHEN c.cluster_name LIKE 'dlt-%' THEN regexp_extract(c.cluster_name, '^dlt-(\\\\d+)-')\n    ELSE NULL\n  END AS job_or_pipeline_id,\n  c.*\nFROM system.compute.clusters c\nQUALIFY (ROW_NUMBER() OVER (PARTITION BY cluster_id ORDER BY change_time DESC) = 1)\n\n),\n \npx_all AS (\n  SELECT DISTINCT\n  sku_name,\n  pricing.default AS unit_price,\n  unit_price::decimal(10,3) AS sku_price\n  FROM system.billing.list_prices \n  QUALIFY ROW_NUMBER() OVER (PARTITION BY sku_name ORDER BY price_start_time DESC) = 1\n  ),\n\n\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\nparsed_tagging_table AS (\n    WITH split_data AS (\n      SELECT \n        split(regexp_replace(:tagging_raw_architecture, '\\\\s+', ''), ';') AS kv_pairs\n    ),\n    exploded_data AS (\n      SELECT \n        monotonically_increasing_id() AS order_id,\n        explode(kv_pairs) AS kv_pair\n      FROM \n        split_data\n    ),\n    clean_keys AS (\n\n      SELECT \n        split(kv_pair, '=')[0] AS key,\n        COALESCE(split(kv_pair, '=')[1], '') AS value,\n        kv_pair AS combination,\n        CASE WHEN contains(kv_pair, '=') THEN 1 ELSE 0 END AS ContainsValuePair\n      FROM \n        exploded_data\n    ),\n\n    aggregated_data AS (\n      SELECT \n        collect_list(key) as keys,\n        collect_list(value) as values, \n        collect_list(CASE WHEN ContainsValuePair = 1 THEN combination END) as KVCombos\n      FROM \n        clean_keys\n    ),\n\n    clean_aggs AS (\n    SELECT \n      map_from_arrays(keys, values) AS result_map,\n      KVCombos\n    FROM \n      aggregated_data LIMIT 1\n    )\n\n    SELECT \n    -- map with only keys\n    MAP_FILTER(result_map, (key, value) -> value = '') AS filtered_map,\n    -- entries that need to match both key and value pairs\n    KVCombos\n    FROM clean_aggs\n),\n\n\n\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\nparsed_discounts_table AS (\n    WITH split_data AS (\n      SELECT \n        split(regexp_replace(upper(:discounts_by_product), '\\\\s+', ''), ';') AS kv_pairs\n    ),\n    exploded_data AS (\n      SELECT \n        monotonically_increasing_id() AS order_id,\n        explode(kv_pairs) AS kv_pair\n      FROM \n        split_data\n    ),\n    clean_keys AS (\n\n      SELECT \n        split(kv_pair, '=')[0] AS product,\n        try_cast(COALESCE(split(kv_pair, '=')[1], 0)::decimal(10,3) AS decimal(10,3)) AS discount,\n        kv_pair AS combination,\n        CASE WHEN contains(kv_pair, '=') THEN 1 ELSE 0 END AS ContainsValuePair\n      FROM \n        exploded_data\n    )\n    SELECT * FROM clean_keys WHERE ContainsValuePair = 1\n)\n\n-- Final Select\nSELECT \nu.*,\nc.*,\nu.workspace_id AS clean_workspace_id,\n-- Calcualte Prices (with discount param)\n  ((1-COALESCE(discounts.discount, 0))*sku_price)*usage_quantity AS Dollar_DBUs,\n-- Clean up cluster / warehouse ids from all places\nCOALESCE(c.cluster_id, u.usage_metadata.cluster_id, usage_metadata.warehouse_id) AS clean_cluster_id,\nCOALESCE(c.job_or_pipeline_id, u.usage_metadata.job_id, u.usage_metadata.dlt_pipeline_id, 'Adhoc Or Serving') AS clean_job_or_pipeline_id,\n\nCASE WHEN u.sku_name LIKE ('%SERVERLESS%') OR u.product_features.is_serverless = 'true' THEN 'Serverless' ELSE 'Self-hosted' END AS IsServerless,\n-- Tagging Policy Identification and Enforcement\n\n-- Get Total Keys Required\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\n\n(SELECT MAX(size(map_keys(filtered_map)) + size(KVCombos)) FROM parsed_tagging_table) AS TotalPolicyTags,\n\n-- When only keys are provided, link keys, but when result_map has a value, check the set of the whole k=v pair\n(\n  ARRAY_DISTINCT(\n      CONCAT(\n          array_intersect(map_keys(u.custom_tags), (SELECT MAX(map_keys(filtered_map)) FROM parsed_tagging_table)) \n          ,array_intersect(\n              TRANSFORM(\n              MAP_KEYS(custom_tags),\n              key -> CONCAT(key, '=', custom_tags[key])\n            ), (SELECT MAX(KVCombos) FROM parsed_tagging_table)\n                          )\n            )\n  )\n) AS CompliantTagKeys,\n\narray_except((SELECT MAX(map_keys(filtered_map)) FROM parsed_tagging_table), map_keys(u.custom_tags)) AS MissingTagKeys,\nsize(CompliantTagKeys) AS NumberOfCompliantKeys,\narray_join(CompliantTagKeys, '_') AS TagPolicyKeys,\n\narray_join(\n  CONCAT(transform(CompliantTagKeys, key -> CONCAT(key, '=', u.custom_tags[key])), -- Get Compliant keys without value pair\n  FILTER(CompliantTagKeys, x -> POSITION('=' IN x) > 0) -- Pull out the compliant values with the key pair\n  )\n  , ';') AS CompliantValues,\n\nCASE WHEN NumberOfCompliantKeys >= TotalPolicyTags THEN 'Compliant' ELSE 'Not Compliant To Tag Policy' END AS IsTaggingCompliant\nFROM system.billing.usage AS u\nLEFT JOIN parsed_discounts_table AS discounts ON discounts.product = u.billing_origin_product\nINNER JOIN px_all AS px ON px.sku_name = u.sku_name\nLEFT JOIN compute AS c\n    ON (c.cluster_id = u.usage_metadata.cluster_id\n        AND (   (c.job_or_pipeline_id = u.usage_metadata.job_id)\n                OR (c.job_or_pipeline_id = u.usage_metadata.dlt_pipeline_id)\n                OR (c.job_or_pipeline_id = 'Adhoc')\n            )\n    )","parameters":[{"displayName":"tagging_raw_architecture","keyword":"tagging_raw_architecture","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"env;system"}]}}},{"displayName":"discounts_by_product","keyword":"discounts_by_product","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"sql=0.0;VECTOR_SEARCH=0.0;ALL_PURPOSE=0.0;MODEL_SERVING=0.0;JOBS=0.0;INTERACTIVE=0.0;LAKEHOUSE_MONITORING=0.0;DLT=0.0"}]}}}]},{"name":"0d493cb1","displayName":"Billing Momentum Indicators","query":"/*\nThis query actually filters on the same tagging framework as the other query as well as date range and product category \nand trends trailing usage metrics as well as moving averages for them\n*/\n\n\nWITH px_all AS (\n  SELECT DISTINCT\n  sku_name,\n  pricing.default AS unit_price,\n  unit_price::decimal(10,3) AS sku_price\n  FROM system.billing.list_prices \n  QUALIFY ROW_NUMBER() OVER (PARTITION BY sku_name ORDER BY price_start_time DESC) = 1\n  ),\n\n\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\nparsed_tagging_table AS (\n    WITH split_data AS (\n      SELECT \n        split(regexp_replace(:tagging_raw_architecture, '\\\\s+', ''), ';') AS kv_pairs\n    ),\n    exploded_data AS (\n      SELECT \n        monotonically_increasing_id() AS order_id,\n        explode(kv_pairs) AS kv_pair\n      FROM \n        split_data\n    ),\n    clean_keys AS (\n\n      SELECT \n        split(kv_pair, '=')[0] AS key,\n        COALESCE(split(kv_pair, '=')[1], '') AS value,\n        kv_pair AS combination,\n        CASE WHEN contains(kv_pair, '=') THEN 1 ELSE 0 END AS ContainsValuePair\n      FROM \n        exploded_data\n    ),\n\n    aggregated_data AS (\n      SELECT \n        collect_list(key) as keys,\n        collect_list(value) as values, \n        collect_list(CASE WHEN ContainsValuePair = 1 THEN combination END) as KVCombos\n      FROM \n        clean_keys\n    ),\n\n    clean_aggs AS (\n    SELECT \n      map_from_arrays(keys, values) AS result_map,\n      KVCombos\n    FROM \n      aggregated_data LIMIT 1\n    )\n\n    SELECT \n    -- map with only keys\n    MAP_FILTER(result_map, (key, value) -> value = '') AS filtered_map,\n    -- entries that need to match both key and value pairs\n    KVCombos\n    FROM clean_aggs\n),\n\n\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\nparsed_discounts_table AS (\n    WITH split_data AS (\n      SELECT \n        split(regexp_replace(upper(:discounts_by_product), '\\\\s+', ''), ';') AS kv_pairs\n    ),\n    exploded_data AS (\n      SELECT \n        monotonically_increasing_id() AS order_id,\n        explode(kv_pairs) AS kv_pair\n      FROM \n        split_data\n    ),\n    clean_keys AS (\n\n      SELECT \n        split(kv_pair, '=')[0] AS product,\n        try_cast(COALESCE(split(kv_pair, '=')[1], 0)::decimal(10,3) AS decimal(10,3)) AS discount,\n        kv_pair AS combination,\n        CASE WHEN contains(kv_pair, '=') THEN 1 ELSE 0 END AS ContainsValuePair\n      FROM \n        exploded_data\n    )\n    SELECT * FROM clean_keys WHERE ContainsValuePair = 1\n),\n\n\nfiltered_usage AS (\n  SELECT u.*,\n  ((1-COALESCE(discounts.discount, 0))*sku_price)*usage_quantity AS DollarDBUs,\n\n  -- Custom Tagging Filtering System\n  (SELECT MAX(size(map_keys(filtered_map)) + size(KVCombos)) FROM parsed_tagging_table) AS TotalPolicyTags,\n\n  -- When only keys are provided, link keys, but when result_map has a value, check the set of the whole k=v pair\n  (\n    ARRAY_DISTINCT(\n        CONCAT(\n            array_intersect(map_keys(u.custom_tags), (SELECT MAX(map_keys(filtered_map)) FROM parsed_tagging_table)) \n            ,array_intersect(\n                TRANSFORM(\n                MAP_KEYS(custom_tags),\n                key -> CONCAT(key, '=', custom_tags[key])\n              ), (SELECT MAX(KVCombos) FROM parsed_tagging_table)\n                            )\n              )\n    )\n  ) AS CompliantTagKeys,\n\n  array_except((SELECT MAX(map_keys(filtered_map)) FROM parsed_tagging_table), map_keys(u.custom_tags)) AS MissingTagKeys,\n  size(CompliantTagKeys) AS NumberOfCompliantKeys,\n  array_join(CompliantTagKeys, '_') AS TagPolicyKeys,\n\n  array_join(\n    CONCAT(transform(CompliantTagKeys, key -> CONCAT(key, '=', u.custom_tags[key])), -- Get Compliant keys without value pair\n    FILTER(CompliantTagKeys, x -> POSITION('=' IN x) > 0) -- Pull out the compliant values with the key pair\n    )\n    , ';') AS CompliantValues,\n\n  CASE \n  WHEN length(:tagging_raw_architecture) = 0 OR :tagging_raw_architecture IS NULL OR :tagging_raw_architecture = 'all' THEN 'Compliant'\n  WHEN NumberOfCompliantKeys >= TotalPolicyTags \n    THEN 'Compliant' \n  ELSE 'Not Compliant To Tag Policy' END AS IsTaggingCompliant\n  FROM system.billing.usage AS u\n  LEFT JOIN parsed_discounts_table AS discounts ON discounts.product = u.billing_origin_product\n  INNER JOIN px_all AS px ON px.sku_name = u.sku_name\n    WHERE \n    -- Date Filter\n    usage_date BETWEEN :usage_start AND :usage_end\n    AND usage_metadata.job_id = 408051558993661\n    AND \n    -- Product Filter\n    (CASE WHEN :product_category = 'all' THEN 1=1 ELSE\n       ARRAY_CONTAINS(split(lower(:product_category), ';'), lower(u.billing_origin_product))\n       END)\n\n),\n\nclean_usage AS (\n    SELECT usage_date, SUM(usage_quantity) AS DBUs, \n    SUM(DollarDBUs) AS DollarDBUs,\n    ROW_NUMBER() OVER (ORDER BY usage_date DESC) AS rn\n    FROM filtered_usage u\n    WHERE IsTaggingCompliant = 'Compliant'\n    GROUP BY usage_date\n)\n\n-- Final Query\nSELECT\n    usage_date,\n    DollarDBUs,\n\n    AVG(DollarDBUs) OVER (\n        ORDER BY usage_date\n        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) AS avg_7d,\n    AVG(DollarDBUs) OVER (\n        ORDER BY usage_date\n        ROWS BETWEEN 29 PRECEDING AND CURRENT ROW\n    ) AS avg_30d,\n    AVG(DollarDBUs) OVER (\n        ORDER BY usage_date\n        ROWS BETWEEN 89 PRECEDING AND CURRENT ROW\n    ) AS avg_90d,\n    AVG(DollarDBUs) OVER (\n        ORDER BY usage_date\n        ROWS BETWEEN 364 PRECEDING AND CURRENT ROW\n    ) AS avg_365d\nFROM -- Roll up to daily level, keep nice a simple for OOTB use cases\n    (SELECT usage_date, SUM(usage_quantity) AS DBUs, \n    SUM(DollarDBUs) AS DollarDBUs,\n    ROW_NUMBER() OVER (ORDER BY usage_date DESC) AS rn\n    FROM filtered_usage u\n    WHERE IsTaggingCompliant = 'Compliant'\n    GROUP BY usage_date\n    )\n-- Optional, depending on your needs: WHERE clause to filter rows\nORDER BY\n    usage_date;","parameters":[{"displayName":"tag_keys","keyword":"tagging_raw_architecture","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"DELETE_ME"}]}}},{"displayName":"usage_start","keyword":"usage_start","dataType":"DATETIME","defaultSelection":{"values":{"dataType":"DATETIME","values":[{"value":"2024-07-26T12:00:00.000"}]}}},{"displayName":"usage_end","keyword":"usage_end","dataType":"DATETIME","defaultSelection":{"values":{"dataType":"DATETIME","values":[{"value":"now/s"}]}}},{"displayName":"discounts_by_product","keyword":"discounts_by_product","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"sql=0.0;VECTOR_SEARCH=0.0;ALL_PURPOSE=0.0;MODEL_SERVING=0.0;JOBS=0.0;INTERACTIVE=0.0;LAKEHOUSE_MONITORING=0.0;DLT=0.0"}]}}},{"displayName":"product_category","keyword":"product_category","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"all"}]}}}]},{"name":"d5cc67cb","displayName":"Trailing Billing Summary","query":"/*\nThis query actually filters on the same tagging framework as the other query as well as date range and product category \nand trends trailing usage metrics as well as moving averages for them\n*/\n\n\nWITH px_all AS (\n  SELECT DISTINCT\n  sku_name,\n  pricing.default AS unit_price,\n  unit_price::decimal(10,3) AS sku_price\n  FROM system.billing.list_prices \n  QUALIFY ROW_NUMBER() OVER (PARTITION BY sku_name ORDER BY price_start_time DESC) = 1\n  ),\n\n\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\nparsed_tagging_table AS (\n    WITH split_data AS (\n      SELECT \n        split(regexp_replace(:tagging_raw_architecture, '\\\\s+', ''), ';') AS kv_pairs\n    ),\n    exploded_data AS (\n      SELECT \n        monotonically_increasing_id() AS order_id,\n        explode(kv_pairs) AS kv_pair\n      FROM \n        split_data\n    ),\n    clean_keys AS (\n\n      SELECT \n        split(kv_pair, '=')[0] AS key,\n        COALESCE(split(kv_pair, '=')[1], '') AS value,\n        kv_pair AS combination,\n        CASE WHEN contains(kv_pair, '=') THEN 1 ELSE 0 END AS ContainsValuePair\n      FROM \n        exploded_data\n    ),\n\n    aggregated_data AS (\n      SELECT \n        collect_list(key) as keys,\n        collect_list(value) as values, \n        collect_list(CASE WHEN ContainsValuePair = 1 THEN combination END) as KVCombos\n      FROM \n        clean_keys\n    ),\n\n    clean_aggs AS (\n    SELECT \n      map_from_arrays(keys, values) AS result_map,\n      KVCombos\n    FROM \n      aggregated_data LIMIT 1\n    )\n\n    SELECT \n    -- map with only keys\n    MAP_FILTER(result_map, (key, value) -> value = '') AS filtered_map,\n    -- entries that need to match both key and value pairs\n    KVCombos\n    FROM clean_aggs\n),\n\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\nparsed_discounts_table AS (\n    WITH split_data AS (\n      SELECT \n        split(regexp_replace(upper(:discounts_by_product), '\\\\s+', ''), ';') AS kv_pairs\n    ),\n    exploded_data AS (\n      SELECT \n        monotonically_increasing_id() AS order_id,\n        explode(kv_pairs) AS kv_pair\n      FROM \n        split_data\n    ),\n    clean_keys AS (\n\n      SELECT \n        split(kv_pair, '=')[0] AS product,\n        try_cast(COALESCE(split(kv_pair, '=')[1], 0)::decimal(10,3) AS decimal(10,3)) AS discount,\n        kv_pair AS combination,\n        CASE WHEN contains(kv_pair, '=') THEN 1 ELSE 0 END AS ContainsValuePair\n      FROM \n        exploded_data\n    )\n    SELECT * FROM clean_keys WHERE ContainsValuePair = 1\n),\n\n\nfiltered_usage AS (\n  SELECT u.*,\n  ((1-COALESCE(discounts.discount, 0))*sku_price)*usage_quantity AS DollarDBUs,\n\n  -- Custom Tagging Filtering System\n  (SELECT MAX(size(map_keys(filtered_map)) + size(KVCombos)) FROM parsed_tagging_table) AS TotalPolicyTags,\n\n  -- When only keys are provided, link keys, but when result_map has a value, check the set of the whole k=v pair\n  (\n    ARRAY_DISTINCT(\n        CONCAT(\n            array_intersect(map_keys(u.custom_tags), (SELECT MAX(map_keys(filtered_map)) FROM parsed_tagging_table)) \n            ,array_intersect(\n                TRANSFORM(\n                MAP_KEYS(custom_tags),\n                key -> CONCAT(key, '=', custom_tags[key])\n              ), (SELECT MAX(KVCombos) FROM parsed_tagging_table)\n                            )\n              )\n    )\n  ) AS CompliantTagKeys,\n\n  array_except((SELECT MAX(map_keys(filtered_map)) FROM parsed_tagging_table), map_keys(u.custom_tags)) AS MissingTagKeys,\n  size(CompliantTagKeys) AS NumberOfCompliantKeys,\n  array_join(CompliantTagKeys, '_') AS TagPolicyKeys,\n\n  array_join(\n    CONCAT(transform(CompliantTagKeys, key -> CONCAT(key, '=', u.custom_tags[key])), -- Get Compliant keys without value pair\n    FILTER(CompliantTagKeys, x -> POSITION('=' IN x) > 0) -- Pull out the compliant values with the key pair\n    )\n    , ';') AS CompliantValues,\n\n  CASE \n  WHEN length(:tagging_raw_architecture) = 0 OR :tagging_raw_architecture IS NULL OR :tagging_raw_architecture = 'all' THEN 'Compliant'\n  WHEN NumberOfCompliantKeys >= TotalPolicyTags \n    THEN 'Compliant' \n  ELSE 'Not Compliant To Tag Policy' END AS IsTaggingCompliant\n  FROM system.billing.usage AS u\n  LEFT JOIN parsed_discounts_table AS discounts ON discounts.product = u.billing_origin_product\n  INNER JOIN px_all AS px ON px.sku_name = u.sku_name\n    WHERE \n    -- Date Filter\n    usage_date BETWEEN :usage_start AND :usage_end\n    AND usage_metadata.job_id = 408051558993661\n    AND \n    -- Product Filter\n    (CASE WHEN :product_category = 'all' THEN 1=1 ELSE\n       ARRAY_CONTAINS(split(lower(:product_category), ';'), lower(u.billing_origin_product))\n       END)\n\n),\n\nclean_usage AS (\n    SELECT usage_date, SUM(usage_quantity) AS DBUs, \n    SUM(DollarDBUs) AS DollarDBUs,\n    ROW_NUMBER() OVER (ORDER BY usage_date DESC) AS rn\n    FROM filtered_usage u\n    WHERE IsTaggingCompliant = 'Compliant'\n    GROUP BY usage_date\n),\n\nT7D_query AS (\n  (SELECT SUM(DollarDBUs) AS T7D FROM clean_usage WHERE rn <= 7)\n),\nT30D_query AS (\n  (SELECT SUM(DollarDBUs) AS T30D FROM clean_usage WHERE rn <= 30)\n),\nT90D_query AS (\n  (SELECT SUM(DollarDBUs) AS T90D FROM clean_usage WHERE rn <= 90)\n),\nT365D_query AS (\n  (SELECT SUM(DollarDBUs) AS T365D FROM clean_usage WHERE rn <= 365)\n)\n\n\n-- Final Query\nSELECT DISTINCT\n-- Calculate Trailing usage right here in subueries\n  (SELECT MAX(T7D) FROM T7D_query) AS T7D_Dollars,\n  (SELECT MAX(T30D) FROM T30D_query) AS T30D_Dollars,\n  (SELECT MAX(T90D) FROM T90D_query) AS T90D_Dollars,\n  (SELECT MAX(T365D) FROM T365D_query) AS T365D_Dollars,\n  try_divide(T7D_Dollars, 7) AS DailyAvgT7D,\n  try_divide(T30D_Dollars, 30) AS DailyAvgT30D,\n  try_divide(T90D_Dollars, 90) AS DailyAvgT90D,\n  try_divide(T365D_Dollars, 365) AS DailyAvgT365D\nLIMIT 1","parameters":[{"displayName":"tagging_raw_architecture","keyword":"tagging_raw_architecture","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"DELETE_ME"}]}}},{"displayName":"usage_start","keyword":"usage_start","dataType":"DATETIME","defaultSelection":{"values":{"dataType":"DATETIME","values":[{"value":"2024-07-25T21:21:45.000"}]}}},{"displayName":"product_category","keyword":"product_category","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"all"}]}}},{"displayName":"discounts_by_product","keyword":"discounts_by_product","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"sql=0.0;VECTOR_SEARCH=0.0;ALL_PURPOSE=0.0;MODEL_SERVING=0.0;JOBS=0.0;INTERACTIVE=0.0;LAKEHOUSE_MONITORING=0.0;DLT=0.0"}]}}},{"displayName":"usage_end","keyword":"usage_end","dataType":"DATETIME","defaultSelection":{"values":{"dataType":"DATETIME","values":[{"value":"now/s"}]}}}]},{"name":"bca7ca72","displayName":"Contract Burndown","query":"WITH px_all AS (\n  SELECT DISTINCT\n  sku_name, \n  pricing.default AS unit_price,\n  unit_price::decimal(10,3) AS sku_price\n  FROM system.billing.list_prices \n  QUALIFY ROW_NUMBER() OVER (PARTITION BY sku_name ORDER BY price_start_time DESC) = 1\n\n  ),\n\ncontract_dates AS (\n  SELECT \n  explode(days) AS usage_date\n  FROM (\n  SELECT sequence(:contract_start_date::date, :contract_end_date::date) AS days\n  )\n),\n\ncontract_burndown AS (\n  SELECT \n  *,\n  SUM(daily_amount) OVER (ORDER BY usage_date) AS cumulative_estimated_contract_usage,\n  try_divide(cumulative_estimated_contract_usage, total_contract_amount) AS estimated_contract_used\n  FROM (\n  SELECT\n    contract_dates.usage_date,\n    :contract_amount::float AS total_contract_amount,\n    (:contract_amount::float / (SELECT COUNT(0) FROM contract_dates)) AS daily_amount\n  FROM contract_dates\n  )\n),\n\n-- Now tag combos can be matched in 2 separate ways: key only, or the key=value pair if optionall provided\nparsed_discounts_table AS (\n    WITH split_data AS (\n      SELECT \n        split(regexp_replace(upper(:discounts_by_product), '\\\\s+', ''), ';') AS kv_pairs\n    ),\n    exploded_data AS (\n      SELECT \n        monotonically_increasing_id() AS order_id,\n        explode(kv_pairs) AS kv_pair\n      FROM \n        split_data\n    ),\n    clean_keys AS (\n\n      SELECT \n        split(kv_pair, '=')[0] AS product,\n        try_cast(COALESCE(split(kv_pair, '=')[1], 0)::decimal(10,3) AS decimal(10,3)) AS discount,\n        kv_pair AS combination,\n        CASE WHEN contains(kv_pair, '=') THEN 1 ELSE 0 END AS ContainsValuePair\n      FROM \n        exploded_data\n    )\n    SELECT * FROM clean_keys WHERE ContainsValuePair = 1\n),\n\n\ndaily_usage AS (\n  SELECT \n  u.usage_date,\n  SUM(((1-COALESCE(discounts.discount, 0))*sku_price)*usage_quantity) AS DollarDBUs,\n  SUM(sku_price*usage_quantity) AS ListDollarDBUs,\n  SUM(usage_quantity) AS DBUs\n  FROM system.billing.usage AS u\n  LEFT JOIN parsed_discounts_table AS discounts ON discounts.product = u.billing_origin_product\n  INNER JOIN px_all AS px ON px.sku_name = u.sku_name\n  GROUP BY u.usage_date\n),\n\nclean_burn AS (\n\nSELECT \nc.*,\nu.usage_date AS u_usage_date,\nu.DollarDBUs,\nu.DBUs,\nSUM(DollarDBUs) OVER (ORDER BY c.usage_date) AS cumulative_actual_spend,\ntry_divide(cumulative_actual_spend, total_contract_amount) AS actual_contract_used,\n-- % completion Flags\nCASE WHEN c.usage_date < current_date() \n  THEN 'Past Usage'\n  WHEN c.usage_date = current_date()\n  THEN 'Today'\n  WHEN c.usage_date > current_date() \n  THEN 'Future'\n  END AS TimePeriodFlag\nFROM contract_burndown c\nLEFT JOIN daily_usage u ON c.usage_date = u.usage_date\n),\n\nwith_flags AS (\nSELECT \n*,\nCASE WHEN usage_date >= current_date()\n      THEN current_date()::date\n      ELSE usage_date::date\n      END AS contract_active_date,\nCASE WHEN cumulative_actual_spend > cumulative_estimated_contract_usage\n    THEN 'Burning Above Run Rate'\n    ELSE 'Within Run Rate'\n    END AS RunRateFlag,\nCASE WHEN  cumulative_actual_spend <= total_contract_amount\n    THEN 'Within Contract'\n    ELSE 'Burst Usage'\n  END AS BurstFlag,\nCASE WHEN  cumulative_actual_spend > total_contract_amount\n    THEN 1\n    ELSE 0\n  END AS DidBurst,\nMAX_BY(estimated_contract_used, usage_date)  FILTER (WHERE TimePeriodFlag != 'Future')*100 AS MostRecentEstimatedBurnProportion,\nMAX_BY(actual_contract_used, usage_date)  FILTER (WHERE TimePeriodFlag != 'Future')*100 AS MostRecentActualBurnProportion\nFROM clean_burn\nGROUP BY ALL\n)\n\nSELECT \n*,\nCOALESCE((SELECT MIN(usage_date) AS burst_date\n  FROM with_flags \n  WHERE DidBurst = 1)::date::string, 'Not Bursting') AS BurstDate\nFROM with_flags \n--WHERE u_usage_date IS NOT NULL -- Will not look into future past current usage\n","parameters":[{"displayName":"contract_start_date","keyword":"contract_start_date","dataType":"DATE","defaultSelection":{"values":{"dataType":"DATE","values":[{"value":"2023-05-01T00:00:00.000"}]}}},{"displayName":"contract_end_date","keyword":"contract_end_date","dataType":"DATE","defaultSelection":{"values":{"dataType":"DATE","values":[{"value":"2024-06-28T00:00:00.000"}]}}},{"displayName":"contract_amount","keyword":"contract_amount","dataType":"DECIMAL","defaultSelection":{"values":{"dataType":"DECIMAL","values":[{"value":"1000000"}]}}},{"displayName":"discounts_by_product","keyword":"discounts_by_product","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"sql=0.0;VECTOR_SEARCH=0.0;ALL_PURPOSE=0.0;MODEL_SERVING=0.0;JOBS=0.0;INTERACTIVE=0.0;LAKEHOUSE_MONITORING=0.0;DLT=0.0"}]}}}]}],"pages":[{"name":"ccfd9f94","displayName":"New Page","layout":[{"widget":{"name":"8786090c","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"billing_origin_product","expression":"`billing_origin_product`"},{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"daily(usage_date)","scale":{"type":"temporal"},"displayName":"usage_date"},"y":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"Usage ( $ DBUs)"},"displayName":"$ DBUs"},"color":{"fieldName":"billing_origin_product","scale":{"type":"categorical","mappings":[{"value":"Delta Live Tables","color":"#7805c6"},{"value":"All Purpose","color":"#00A972"},{"value":"Model Serving","color":"#2c62eb"},{"value":"Jobs","color":"#077A9D"},{"value":"ALL_PURPOSE","color":"#1356d4"}]},"legend":{"title":"Category","position":"bottom"},"displayName":"Category"},"label":{"show":false}},"frame":{"showTitle":true,"title":"Spend By Category"}}},"position":{"x":0,"y":14,"width":6,"height":6}},{"widget":{"name":"d9a03a88","queries":[{"name":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_daily(usage_date)","query":{"datasetName":"a4ec3948","fields":[{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"daily(usage_date)_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-date-range-picker","encodings":{"fields":[{"fieldName":"daily(usage_date)","displayName":"usage_date","queryName":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_daily(usage_date)"}]},"frame":{"showTitle":true,"title":"Usage Date"}}},"position":{"x":0,"y":3,"width":2,"height":2}},{"widget":{"name":"b57a8b4f","textbox_spec":"# Usage Advisor Dashboard\n\n#### Section 1 - Billing Advisor - See where your costs are going\n#### Section 2- Contract Monitor - Check Actual Usage Against Estimated Contract Burndown\n#### Section 3 - Tagging Manager - Implement, Audit, and Enforce Tagging Policies across all compute\n#### Section 4 - Billing Momentum & Trends Analysis With Custom Tagging Filters\n-----"},"position":{"x":0,"y":0,"width":6,"height":3}},{"widget":{"name":"c6892aa0","queries":[{"name":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_sku_name","query":{"datasetName":"a4ec3948","fields":[{"name":"sku_name","expression":"`sku_name`"},{"name":"sku_name_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"sku_name","displayName":"sku_name","queryName":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_sku_name"}]},"frame":{"showTitle":true,"title":"SKU"}}},"position":{"x":2,"y":3,"width":1,"height":2}},{"widget":{"name":"ebada230","queries":[{"name":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_billing_origin_product","query":{"datasetName":"a4ec3948","fields":[{"name":"billing_origin_product","expression":"`billing_origin_product`"},{"name":"billing_origin_product_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"billing_origin_product","displayName":"billing_origin_product","queryName":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_billing_origin_product"}]},"frame":{"showTitle":true,"title":"Product Category"}}},"position":{"x":3,"y":3,"width":1,"height":2}},{"widget":{"name":"ec8a66c7","queries":[{"name":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_IsServerless","query":{"datasetName":"a4ec3948","fields":[{"name":"IsServerless","expression":"`IsServerless`"},{"name":"IsServerless_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"IsServerless","displayName":"IsServerless","queryName":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_IsServerless"}]},"frame":{"showTitle":true,"title":"Serverless?"}}},"position":{"x":5,"y":3,"width":1,"height":2}},{"widget":{"name":"827185d3","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"sku_name","expression":"`sku_name`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"daily(usage_date)","scale":{"type":"temporal"},"displayName":"usage_date"},"y":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"displayName":"Usage ($ DBUs)"},"color":{"fieldName":"sku_name","scale":{"type":"categorical","mappings":[{"value":"Delta Live Tables","color":"#0567c6"},{"value":"ENTERPRISE_ALL_PURPOSE_COMPUTE","color":"#1356d4"}]},"legend":{"position":"bottom"},"displayName":"SKU"}},"frame":{"showTitle":true,"title":"Spend By SKU"},"mark":{"layout":"stack"}}},"position":{"x":0,"y":20,"width":6,"height":7}},{"widget":{"name":"221a302a","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"IsServerless","expression":"`IsServerless`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"Total Usage ($ DBUs)"},"displayName":"Total Usage ($ DBUs)"},"color":{"fieldName":"IsServerless","scale":{"type":"categorical","mappings":[{"value":"Serverless","color":"#00A972"},{"value":"Hosted","color":"#1356d4"}]},"legend":{"position":"bottom","title":"Is Serverless"},"displayName":"Is Serverless"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Serverless %"},"mark":{"layout":"percent-stack"}}},"position":{"x":0,"y":10,"width":2,"height":4}},{"widget":{"name":"59da71c0","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"owned_by","expression":"`owned_by`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative","fn":{"type":"symlog"}},"axis":{"title":"Usage ($ DBUs)"},"displayName":"Usage (DBUs)"},"y":{"fieldName":"owned_by","scale":{"type":"categorical","sort":{"by":"x-reversed"}},"displayName":"Cluster Owner"},"color":{"fieldName":"owned_by","scale":{"type":"categorical"},"displayName":"owned_by"}},"frame":{"showTitle":true,"title":"Usage By Cluster Owner"},"mark":{"layout":"stack"}}},"position":{"x":0,"y":27,"width":3,"height":9}},{"widget":{"name":"2899fba4","queries":[{"name":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_owned_by","query":{"datasetName":"a4ec3948","fields":[{"name":"owned_by","expression":"`owned_by`"},{"name":"owned_by_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"owned_by","displayName":"owned_by","queryName":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_owned_by"}]},"frame":{"showTitle":true,"title":"Owned By"}}},"position":{"x":4,"y":3,"width":1,"height":2}},{"widget":{"name":"47a47f9a","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"billing_origin_product","expression":"`billing_origin_product`"},{"name":"clean_cluster_id","expression":"`clean_cluster_id`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative","fn":{"type":"symlog"}},"displayName":"Usage ($ DBUs)"},"y":{"fieldName":"clean_cluster_id","scale":{"type":"categorical","sort":{"by":"x-reversed"}},"displayName":"Cluster / Warehouse Id"},"color":{"fieldName":"billing_origin_product","scale":{"type":"categorical"},"displayName":"Cluster Type"}},"frame":{"showTitle":true,"title":"Usage By Cluster Id"}}},"position":{"x":3,"y":27,"width":3,"height":9}},{"widget":{"name":"108a8832","textbox_spec":"## Compute Tagging Manager\n-----\nThis section helps define a tagging policy system, group analysis by that tagging framework, and audit non-compliance to a given tagging architecture for enterprise observability"},"position":{"x":0,"y":60,"width":6,"height":2}},{"widget":{"name":"4f01bb57","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_tagging_raw_architecture","query":{"datasetName":"a4ec3948","parameters":[{"name":"tagging_raw_architecture","keyword":"tagging_raw_architecture"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"tagging_raw_architecture","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_tagging_raw_architecture"}]},"frame":{"showTitle":true,"title":"Dynamic Tagging Policy","showDescription":true,"description":"Define a tagging architecture here in the format of \nkey1=value1;key2=value2 (values are optional). If values are povided, this also enforces the provided values. \n\nFrom this, the visuals in this section will identify which clusters/jobs enforce this policy so you can see usage by this tagging architecture as well as identify improperly tagged clusters/jobs. (for single tag keys, do not include ;)"}}},"position":{"x":2,"y":62,"width":4,"height":1}},{"widget":{"name":"74b777f5","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"IsTaggingCompliant","expression":"`IsTaggingCompliant`"},{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"daily(usage_date)","scale":{"type":"temporal"},"displayName":"Usage Date"},"y":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"Usage ($ DBUs)"},"displayName":"Usage (DBUs)"},"color":{"fieldName":"IsTaggingCompliant","scale":{"type":"categorical","mappings":[{"value":"Not Compliant To Tag Policy","color":"#FF3621"},{"value":"Compliant","color":"#00A972"}]},"legend":{"title":"Tag Policy Compliance","position":"bottom"},"displayName":"Tag Policy Compliance"}},"frame":{"showTitle":true,"title":"Usage By Compliance"}}},"position":{"x":0,"y":77,"width":6,"height":6}},{"widget":{"name":"3c9cd198","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"IsTaggingCompliant","expression":"`IsTaggingCompliant`"},{"name":"countdistinct(clean_cluster_id)","expression":"COUNT(DISTINCT `clean_cluster_id`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"countdistinct(clean_cluster_id)","scale":{"type":"quantitative"},"displayName":"Cluster Ids"},"color":{"fieldName":"IsTaggingCompliant","scale":{"type":"categorical","mappings":[{"value":"Not Compliant To Tag Policy","color":"#FF3621"},{"value":"Compliant","color":"#00A972"}]},"displayName":"Tag Policy Compliance"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Clusters By Compliance"},"mark":{"layout":"percent-stack"}}},"position":{"x":2,"y":64,"width":2,"height":6}},{"widget":{"name":"7957bd99","queries":[{"name":"dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_IsTaggingCompliant","query":{"datasetName":"a4ec3948","fields":[{"name":"IsTaggingCompliant","expression":"`IsTaggingCompliant`"},{"name":"IsTaggingCompliant_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"IsTaggingCompliant","displayName":"IsTaggingCompliant","queryName":"dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_IsTaggingCompliant"}]},"frame":{"showTitle":true,"title":"Is Compliant to Tag Policy?","showDescription":false,"description":""}}},"position":{"x":0,"y":62,"width":1,"height":2}},{"widget":{"name":"ae4826cf","queries":[{"name":"dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_MissingTagKeys","query":{"datasetName":"a4ec3948","fields":[{"name":"MissingTagKeys","expression":"`MissingTagKeys`"},{"name":"MissingTagKeys_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"MissingTagKeys","displayName":"MissingTagKeys","queryName":"dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_MissingTagKeys"}]},"frame":{"showTitle":true,"title":"Missing Tag Keys","showDescription":false,"description":"Define tag policy below"}}},"position":{"x":1,"y":62,"width":1,"height":2}},{"widget":{"name":"03848216","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"CompliantValues","expression":"`CompliantValues`"},{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"daily(usage_date)","scale":{"type":"temporal"},"displayName":"Usage Date"},"y":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"Usage ($ DBUs)"},"displayName":"Usage (DBUs)"},"color":{"fieldName":"CompliantValues","scale":{"type":"categorical","mappings":[{"value":"","color":"#919191"},{"value":"demo_project","color":"#1461df"}]},"legend":{"title":"Tag Key Values (values of all tag keys in policy)"},"displayName":"Tag Keys"}},"frame":{"showTitle":true,"title":"Usage By Tag Values Over Time"}}},"position":{"x":0,"y":83,"width":6,"height":7}},{"widget":{"name":"df5133b7","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"count(*)","expression":"COUNT(`*`)"},{"name":"IsTaggingCompliant","expression":"`IsTaggingCompliant`"},{"name":"sku_name","expression":"`sku_name`"},{"name":"clean_cluster_id","expression":"`clean_cluster_id`"},{"name":"clean_job_or_pipeline_id","expression":"`clean_job_or_pipeline_id`"},{"name":"owned_by","expression":"`owned_by`"},{"name":"identity_metadata","expression":"`identity_metadata`"},{"name":"CompliantValues","expression":"`CompliantValues`"},{"name":"MissingTagKeys","expression":"`MissingTagKeys`"}],"cubeGroupingSets":{"sets":[{"fieldNames":["clean_cluster_id","clean_job_or_pipeline_id","owned_by","identity_metadata","CompliantValues","MissingTagKeys"]},{"fieldNames":["IsTaggingCompliant","sku_name"]}]},"disaggregated":false,"orders":[{"direction":"ASC","expression":"`clean_cluster_id`"},{"direction":"ASC","expression":"`clean_job_or_pipeline_id`"},{"direction":"ASC","expression":"`owned_by`"},{"direction":"ASC","expression":"`identity_metadata`"},{"direction":"ASC","expression":"`CompliantValues`"},{"direction":"ASC","expression":"`MissingTagKeys`"},{"direction":"ASC","expression":"`IsTaggingCompliant`"},{"direction":"ASC","expression":"`sku_name`"}]}}],"spec":{"version":3,"widgetType":"pivot","encodings":{"rows":[{"fieldName":"clean_cluster_id","displayName":"clean_cluster_id"},{"fieldName":"clean_job_or_pipeline_id","displayName":"clean_job_or_pipeline_id"},{"fieldName":"owned_by","displayName":"owned_by"},{"fieldName":"identity_metadata","displayName":"identity_metadata"},{"fieldName":"CompliantValues","displayName":"CompliantValues"},{"fieldName":"MissingTagKeys","displayName":"MissingTagKeys"}],"columns":[{"fieldName":"IsTaggingCompliant","displayName":"IsTaggingCompliant"},{"fieldName":"sku_name","displayName":"sku_name"}],"cell":{"type":"single-cell","fieldName":"count(*)","cellType":"text","displayName":"Count of Records"}},"frame":{"showTitle":true,"title":"Clusters & Jobs/DLT pipelines By Compliance","showDescription":true,"description":"Pivot Table / Report To Identify Untagged Clusters / Jobs that do not adhere to the defined tagging policy (value is the count of billing record hours)"}}},"position":{"x":0,"y":90,"width":6,"height":7}},{"widget":{"name":"e744dd89","queries":[{"name":"dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_clean_cluster_id","query":{"datasetName":"a4ec3948","fields":[{"name":"clean_cluster_id","expression":"`clean_cluster_id`"},{"name":"clean_cluster_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"clean_cluster_id","displayName":"clean_cluster_id","queryName":"dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_clean_cluster_id"}]},"frame":{"showTitle":true,"title":"Cluster / Warehouse Id"}}},"position":{"x":2,"y":5,"width":1,"height":2}},{"widget":{"name":"6b559f22","queries":[{"name":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_clean_job_or_pipeline_id","query":{"datasetName":"a4ec3948","fields":[{"name":"clean_job_or_pipeline_id","expression":"`clean_job_or_pipeline_id`"},{"name":"clean_job_or_pipeline_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"clean_job_or_pipeline_id","displayName":"clean_job_or_pipeline_id","queryName":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_clean_job_or_pipeline_id"}]},"frame":{"showTitle":true,"title":"Job / Pipeline Id"}}},"position":{"x":3,"y":5,"width":1,"height":2}},{"widget":{"name":"d8b1a3c0","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"},{"name":"sum(usage_quantity)","expression":"SUM(`usage_quantity`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"sum(Dollar_DBUs)","displayName":"Sum of Dollar_DBUs"},"target":{"fieldName":"sum(usage_quantity)","displayName":"Sum of usage_quantity"}},"frame":{"showTitle":true,"title":"Total Usage In Period - $DBUs","showDescription":true,"description":"(DBUs)"}}},"position":{"x":0,"y":7,"width":1,"height":3}},{"widget":{"name":"f4fc1987","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"IsTaggingCompliant","expression":"`IsTaggingCompliant`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"$DBUs"},"displayName":"Cluster Ids"},"color":{"fieldName":"IsTaggingCompliant","scale":{"type":"categorical","mappings":[{"value":"Not Compliant To Tag Policy","color":"#FF3621"},{"value":"Compliant","color":"#00A972"}]},"displayName":"Tag Policy Compliance"},"label":{"show":true}},"frame":{"showTitle":true,"title":"$ DBUs By Compliance"},"mark":{"layout":"percent-stack"}}},"position":{"x":0,"y":64,"width":2,"height":6}},{"widget":{"name":"2a4a44f7","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"billing_origin_product","expression":"`billing_origin_product`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"Total Usage ($ DBUs)"},"displayName":"Total Usage ($ DBUs)"},"y":{"fieldName":"billing_origin_product","scale":{"type":"categorical","sort":{"by":"x-reversed"}},"displayName":"Product Category"},"color":{"fieldName":"billing_origin_product","scale":{"type":"categorical","mappings":[{"value":"ALL_PURPOSE","color":"#0f4ad3"}]},"displayName":"billing_origin_product"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Total Spend By Product Category"}}},"position":{"x":4,"y":7,"width":2,"height":7}},{"widget":{"name":"4660789a","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"countdistinct(clean_workspace_id)","expression":"COUNT(DISTINCT `clean_workspace_id`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"countdistinct(clean_workspace_id)","displayName":"Count of Unique clean_workspace_id"}},"frame":{"showTitle":true,"title":"Workspace Count","showDescription":false,"description":""}}},"position":{"x":1,"y":7,"width":1,"height":3}},{"widget":{"name":"42c3bc2b","queries":[{"name":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_clean_workspace_id","query":{"datasetName":"a4ec3948","fields":[{"name":"clean_workspace_id","expression":"`clean_workspace_id`"},{"name":"clean_workspace_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"clean_workspace_id","displayName":"clean_workspace_id","queryName":"dashboards/01eeed27c1e41344b1a06cd65ca8285c/datasets/01eeffb505f316c6bd35a4e4a020cee6_clean_workspace_id"}]},"frame":{"showTitle":true,"title":"Workspace Id"}}},"position":{"x":0,"y":5,"width":2,"height":2}},{"widget":{"name":"ab5a16bc","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"clean_workspace_id","expression":"`clean_workspace_id`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative","reverse":false},"axis":{"title":"Total Usage ($ DBUs)"},"displayName":"Total Usage ($ DBUs)"},"y":{"fieldName":"clean_workspace_id","displayName":"Workspace Id","scale":{"type":"categorical","sort":{"by":"x-reversed"}}},"color":{"fieldName":"clean_workspace_id","scale":{"type":"categorical","mappings":[{"value":"Serverless","color":"#00A972"},{"value":"Hosted","color":"#1356d4"}]},"legend":{"position":"bottom","title":"Workspace"},"displayName":"SKU Category"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Total Spend By Workspace"},"mark":{"layout":"group"}}},"position":{"x":2,"y":7,"width":2,"height":7}},{"widget":{"name":"516bd8bd","textbox_spec":"-----\n## Trending Workload Dashboard with Trailing and Moving Averages For Usage with Dynamic Filters\n-----"},"position":{"x":0,"y":97,"width":6,"height":2}},{"widget":{"name":"76e8a9fd","queries":[{"name":"main_query","query":{"datasetName":"0d493cb1","fields":[{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"sum(avg_7d)","expression":"SUM(`avg_7d`)"},{"name":"sum(avg_30d)","expression":"SUM(`avg_30d`)"},{"name":"sum(avg_90d)","expression":"SUM(`avg_90d`)"},{"name":"sum(avg_365d)","expression":"SUM(`avg_365d`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"line","encodings":{"x":{"fieldName":"daily(usage_date)","scale":{"type":"temporal"},"displayName":"usage_date"},"y":{"scale":{"type":"quantitative"},"fields":[{"fieldName":"sum(avg_7d)","displayName":"7d Moving Average"},{"fieldName":"sum(avg_30d)","displayName":"30d Moving Average"},{"fieldName":"sum(avg_90d)","displayName":"90d Moving Average"},{"fieldName":"sum(avg_365d)","displayName":"365d Moving Average"}],"axis":{"title":"Usage $ DBUs"}}},"frame":{"showTitle":true,"title":"Usage Momentum Moving Averages (7d, 30d, 90d, 365d)"}}},"position":{"x":0,"y":104,"width":6,"height":7}},{"widget":{"name":"2adc16ac","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_tagging_raw_architecture","query":{"datasetName":"d5cc67cb","parameters":[{"name":"tagging_raw_architecture","keyword":"tagging_raw_architecture"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_tagging_raw_architecture","query":{"datasetName":"0d493cb1","parameters":[{"name":"tagging_raw_architecture","keyword":"tagging_raw_architecture"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"tagging_raw_architecture","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_tagging_raw_architecture"},{"parameterName":"tagging_raw_architecture","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_tagging_raw_architecture"}]},"frame":{"showTitle":true,"showDescription":true,"title":"Tagging Dynamic Filter","description":"Define a tagging filter here in the format of \nkey1=value1;key2=value2 (values are optional)"}}},"position":{"x":2,"y":99,"width":2,"height":2}},{"widget":{"name":"abaec030","queries":[{"name":"main_query","query":{"datasetName":"0d493cb1","fields":[{"name":"sum(DollarDBUs)","expression":"SUM(`DollarDBUs`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"sum(DollarDBUs)","displayName":"Sum of DollarDBUs"}},"frame":{"showTitle":true,"showDescription":false,"title":"Total Usage ($ DBU)"}}},"position":{"x":0,"y":101,"width":2,"height":3}},{"widget":{"name":"10313c5b","queries":[{"name":"main_query","query":{"datasetName":"d5cc67cb","fields":[{"name":"max(DailyAvgT7D)","expression":"MAX(`DailyAvgT7D`)"},{"name":"max(T7D_Dollars)","expression":"MAX(`T7D_Dollars`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"max(T7D_Dollars)","displayName":"Maximum T7D_Dollars"},"target":{"fieldName":"max(DailyAvgT7D)","displayName":"Maximum DailyAvgT7D"}},"frame":{"showTitle":true,"showDescription":true,"title":"T7D $ DBUs","description":"(Daily Avg in T7D)"}}},"position":{"x":2,"y":101,"width":1,"height":3}},{"widget":{"name":"d76f9f20","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_usage_start","query":{"datasetName":"0d493cb1","parameters":[{"name":"usage_start","keyword":"usage_start"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_usage_start","query":{"datasetName":"d5cc67cb","parameters":[{"name":"usage_start","keyword":"usage_start"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-date-picker","encodings":{"fields":[{"parameterName":"usage_start","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_usage_start"},{"parameterName":"usage_start","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_usage_start"}]},"frame":{"showTitle":true,"title":"Usage Start"}}},"position":{"x":0,"y":99,"width":1,"height":2}},{"widget":{"name":"0fcda858","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_usage_end","query":{"datasetName":"0d493cb1","parameters":[{"name":"usage_end","keyword":"usage_end"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_usage_end","query":{"datasetName":"d5cc67cb","parameters":[{"name":"usage_end","keyword":"usage_end"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-date-picker","encodings":{"fields":[{"parameterName":"usage_end","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_usage_end"},{"parameterName":"usage_end","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_usage_end"}]},"frame":{"showTitle":true,"title":"Usage End"}}},"position":{"x":1,"y":99,"width":1,"height":2}},{"widget":{"name":"5c2470bb","queries":[{"name":"main_query","query":{"datasetName":"d5cc67cb","fields":[{"name":"max(DailyAvgT30D)","expression":"MAX(`DailyAvgT30D`)"},{"name":"max(T30D_Dollars)","expression":"MAX(`T30D_Dollars`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"max(T30D_Dollars)","displayName":"Maximum T30D_Dollars"},"target":{"fieldName":"max(DailyAvgT30D)","displayName":"Maximum DailyAvgT30D"}},"frame":{"showTitle":true,"showDescription":true,"title":"T30D $ DBUs","description":"(Daily Avg in T30)"}}},"position":{"x":3,"y":101,"width":1,"height":3}},{"widget":{"name":"0a9f071d","queries":[{"name":"main_query","query":{"datasetName":"d5cc67cb","fields":[{"name":"max(DailyAvgT365D)","expression":"MAX(`DailyAvgT365D`)"},{"name":"max(T365D_Dollars)","expression":"MAX(`T365D_Dollars`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"max(T365D_Dollars)","displayName":"Maximum T365D_Dollars"},"target":{"fieldName":"max(DailyAvgT365D)","displayName":"Maximum DailyAvgT365D"}},"frame":{"showTitle":true,"showDescription":true,"title":"T365D $ DBUs","description":"(Daily Avg In T365D)"}}},"position":{"x":5,"y":101,"width":1,"height":3}},{"widget":{"name":"edb814a2","queries":[{"name":"main_query","query":{"datasetName":"d5cc67cb","fields":[{"name":"max(DailyAvgT90D)","expression":"MAX(`DailyAvgT90D`)"},{"name":"max(T90D_Dollars)","expression":"MAX(`T90D_Dollars`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"max(T90D_Dollars)","displayName":"Maximum T90D_Dollars"},"target":{"fieldName":"max(DailyAvgT90D)","displayName":"Maximum DailyAvgT90D"}},"frame":{"showTitle":true,"showDescription":true,"title":"T90D $ DBUs","description":"(Daily Avg In T90D)"}}},"position":{"x":4,"y":101,"width":1,"height":3}},{"widget":{"name":"aa1beda6","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_product_category","query":{"datasetName":"0d493cb1","parameters":[{"name":"product_category","keyword":"product_category"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_product_category","query":{"datasetName":"d5cc67cb","parameters":[{"name":"product_category","keyword":"product_category"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"product_category","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_product_category"},{"parameterName":"product_category","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_product_category"}]},"frame":{"showTitle":true,"showDescription":true,"title":"Product Category Filter","description":"Shows which product category(s) you want to view *If left blank or 'all', then no filter will be applied"}}},"position":{"x":4,"y":100,"width":2,"height":1}},{"widget":{"name":"9e193076","textbox_spec":"## Contract Burndown Monitor\n-----\nThis section allows users to input contract dates, and amount to track usage during a specific contract time window. This helps estimate \"high usage\" time periods and get a sense for what proportion of your contract is used relative to the date of refresh. "},"position":{"x":0,"y":36,"width":6,"height":2}},{"widget":{"name":"9a4a9add","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"RunRateFlag","expression":"`RunRateFlag`"},{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"sum(DollarDBUs)","expression":"SUM(`DollarDBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"line","encodings":{"x":{"fieldName":"daily(usage_date)","scale":{"type":"temporal"},"axis":{"title":"Usage Date"},"displayName":"Usage Date"},"y":{"fieldName":"sum(DollarDBUs)","scale":{"type":"quantitative"},"axis":{"title":"Spend ($)"},"displayName":"Actual Daily Spend"},"color":{"fieldName":"RunRateFlag","scale":{"type":"categorical","mappings":[{"value":"Burning Above Run Rate","color":"#FF3621"}]},"displayName":"Spending Above Estimated Run Rate?","legend":{"position":"bottom"}}},"frame":{"showTitle":true,"title":"Spend Over Time (Not Cumulative) - (By Run Rate)"},"mark":{"colors":["#00A972","#00A972","#FF3621","#8BCAE7","#AB4057","#99DDB4","#FCA4A1","#919191","#BF7080"]}}},"position":{"x":0,"y":54,"width":6,"height":6}},{"widget":{"name":"307c406e","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"max(total_contract_amount)","expression":"MAX(`total_contract_amount`)"},{"name":"sum(DollarDBUs)","expression":"SUM(`DollarDBUs`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"sum(DollarDBUs)","displayName":"Sum of DollarDBUs"},"target":{"fieldName":"max(total_contract_amount)","displayName":"Maximum total_contract_amount"}},"frame":{"showTitle":true,"title":"Total Usage In Period ","showDescription":true,"description":"(Total Contract Value)"}}},"position":{"x":0,"y":40,"width":1,"height":2}},{"widget":{"name":"3b66ed05","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"monthly(usage_date)","expression":"DATE_TRUNC(\"MONTH\", `usage_date`)"},{"name":"max(cumulative_actual_spend)","expression":"MAX(`cumulative_actual_spend`)"},{"name":"max(cumulative_estimated_contract_usage)","expression":"MAX(`cumulative_estimated_contract_usage`)"},{"name":"max(total_contract_amount)","expression":"MAX(`total_contract_amount`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"line","encodings":{"x":{"fieldName":"monthly(usage_date)","scale":{"type":"temporal"},"displayName":"Usage Date"},"y":{"scale":{"type":"quantitative"},"fields":[{"fieldName":"max(cumulative_actual_spend)","displayName":"Actual Cumulative Usage"},{"fieldName":"max(cumulative_estimated_contract_usage)","displayName":"Estimated Contract Cumulative Usage"},{"fieldName":"max(total_contract_amount)","displayName":"Total Contract Amount"}],"axis":{"hideTitle":true,"title":"Cumulative Usage"}},"color":{"legend":{"position":"bottom"}}},"frame":{"showTitle":true,"title":"Cumulative Usage - Actual vs Estimated (Linear by TCV)"},"mark":{"colors":["#00A972","#8BCAE7","#FF3621","#FF3621","#8BCAE7","#AB4057","#99DDB4","#FCA4A1","#919191","#BF7080"]}}},"position":{"x":0,"y":48,"width":6,"height":6}},{"widget":{"name":"6692efe2","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_contract_start_date","query":{"datasetName":"bca7ca72","parameters":[{"name":"contract_start_date","keyword":"contract_start_date"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-date-picker","encodings":{"fields":[{"parameterName":"contract_start_date","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_contract_start_date"}]},"frame":{"showTitle":true,"title":"Contract Start"}}},"position":{"x":0,"y":38,"width":1,"height":2}},{"widget":{"name":"e947ecb9","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_contract_end_date","query":{"datasetName":"bca7ca72","parameters":[{"name":"contract_end_date","keyword":"contract_end_date"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-date-picker","encodings":{"fields":[{"parameterName":"contract_end_date","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_contract_end_date"}]},"frame":{"showTitle":true,"title":"Contract End"}}},"position":{"x":1,"y":38,"width":1,"height":2}},{"widget":{"name":"547c0fd0","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_contract_amount","query":{"datasetName":"bca7ca72","parameters":[{"name":"contract_amount","keyword":"contract_amount"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"contract_amount","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_contract_amount"}]},"frame":{"showTitle":true,"title":"Contract Total Value ($ TCV)"}}},"position":{"x":2,"y":38,"width":2,"height":2}},{"widget":{"name":"bf2d8e43","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"max(MostRecentActualBurnProportion)","expression":"MAX(`MostRecentActualBurnProportion`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"max(MostRecentActualBurnProportion)","displayName":"Maximum MostRecentActualBurnProportion"}},"frame":{"showTitle":true,"title":"% Actual Contract Used"}}},"position":{"x":3,"y":40,"width":1,"height":2}},{"widget":{"name":"289f86ce","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"max(MostRecentActualBurnProportion)","expression":"MAX(`MostRecentActualBurnProportion`)"},{"name":"max(MostRecentEstimatedBurnProportion)","expression":"MAX(`MostRecentEstimatedBurnProportion`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"max(MostRecentEstimatedBurnProportion)","displayName":"Maximum MostRecentEstimatedBurnProportion"},"target":{"fieldName":"max(MostRecentActualBurnProportion)","displayName":"Maximum MostRecentActualBurnProportion"}},"frame":{"showTitle":true,"title":"% Estimated Contract Used (Linear by TCV)","showDescription":true,"description":"(Actual %)"}}},"position":{"x":1,"y":40,"width":2,"height":2}},{"widget":{"name":"54cbbeb6","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"BurstFlag","expression":"`BurstFlag`"},{"name":"sum(DollarDBUs)","expression":"SUM(`DollarDBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"y":{"fieldName":"sum(DollarDBUs)","scale":{"type":"quantitative"},"displayName":"Usage ($)"},"color":{"fieldName":"BurstFlag","scale":{"type":"categorical","mappings":[{"value":"Burst Usage","color":"#FF3621"},{"value":"Within Contract","color":"#00A972"}]},"displayName":"Usage Type"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Contract Pacing","showDescription":false,"description":""}}},"position":{"x":0,"y":42,"width":1,"height":6}},{"widget":{"name":"f4ff7962","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"BurstFlag","expression":"`BurstFlag`"},{"name":"daily(usage_date)","expression":"DATE_TRUNC(\"DAY\", `usage_date`)"},{"name":"sum(cumulative_actual_spend)","expression":"SUM(`cumulative_actual_spend`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"daily(usage_date)","scale":{"type":"temporal"},"displayName":"Usage Date"},"y":{"fieldName":"sum(cumulative_actual_spend)","scale":{"type":"quantitative"},"displayName":"Cumulative Usage ($)"},"color":{"fieldName":"BurstFlag","scale":{"type":"categorical","mappings":[{"value":"Burst Usage","color":"#FF3621"},{"value":"Within Contract","color":"#00A972"}]},"legend":{"position":"bottom"},"displayName":"Usage Type"},"label":{"show":false}},"frame":{"showTitle":true,"title":"Contract Burst Chart","showDescription":true,"description":"Shows cumulative usage by whether usage has burst over contract"}}},"position":{"x":1,"y":42,"width":5,"height":6}},{"widget":{"name":"1f3aff92","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_discounts_by_product","query":{"datasetName":"bca7ca72","parameters":[{"name":"discounts_by_product","keyword":"discounts_by_product"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"discounts_by_product","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef1138435f120eb1609bf24f7752b6_discounts_by_product"}]},"frame":{"showTitle":true,"title":"Product SKU Discounts (by Product Category)","showDescription":true,"description":"; separated list of discount rates by product (i.e. SQL=0.1 means a 10% discount on DBSQL Usage)"}}},"position":{"x":4,"y":38,"width":2,"height":2}},{"widget":{"name":"1faf69f6","queries":[{"name":"main_query","query":{"datasetName":"bca7ca72","fields":[{"name":"BurstDate","expression":"`BurstDate`"}],"disaggregated":true}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"BurstDate","displayName":"BurstDate"}},"frame":{"showTitle":true,"title":"Actual Burst Date"}}},"position":{"x":4,"y":40,"width":2,"height":2}},{"widget":{"name":"3ec6ed39","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_discounts_by_product","query":{"datasetName":"a4ec3948","parameters":[{"name":"discounts_by_product","keyword":"discounts_by_product"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"discounts_by_product","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_discounts_by_product"}]},"frame":{"showTitle":true,"title":"Discounts by Product Category (below)","showDescription":true,"description":"; separated list of discount rates by product (i.e. SQL=0.1 means a 10% discount on DBSQL Usage)"}}},"position":{"x":4,"y":5,"width":2,"height":2}},{"widget":{"name":"33e25eb3","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_discounts_by_product","query":{"datasetName":"d5cc67cb","parameters":[{"name":"discounts_by_product","keyword":"discounts_by_product"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_discounts_by_product","query":{"datasetName":"0d493cb1","parameters":[{"name":"discounts_by_product","keyword":"discounts_by_product"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"discounts_by_product","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef028a8b2b18da9269509bcd612d00_discounts_by_product"},{"parameterName":"discounts_by_product","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c891982b51968cfa5364f95_discounts_by_product"}]},"frame":{"showTitle":true,"title":"Product SKU Discounts (by Product Category)","showDescription":true,"description":"; separated list of discount rates by product (i.e. SQL=0.1 means a 10% discount on DBSQL Usage)"}}},"position":{"x":4,"y":99,"width":2,"height":1}},{"widget":{"name":"c9c0064b","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"CompliantValues","expression":"`CompliantValues`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"Usage ($ DBUs)"},"displayName":"Usage (DBUs)"},"color":{"fieldName":"CompliantValues","scale":{"type":"categorical","mappings":[{"value":"","color":"#919191"},{"value":"demo_project","color":"#1461df"}]},"legend":{"title":"Tag Key Values (values of all tag keys in policy)"},"displayName":"Tag Keys"}},"frame":{"showTitle":true,"title":"% Usage By Tag Values"},"mark":{"layout":"percent-stack"}}},"position":{"x":4,"y":64,"width":2,"height":6}},{"widget":{"name":"3ab841c1","queries":[{"name":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_discounts_by_product","query":{"datasetName":"a4ec3948","parameters":[{"name":"discounts_by_product","keyword":"discounts_by_product"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"parameterName":"discounts_by_product","queryName":"parameter_dashboards/01ef02691c7d1117911c501cc8d148c7/datasets/01ef02691c8618c7bfb8f1eb063dd20d_discounts_by_product"}]},"frame":{"showTitle":true,"title":"Product SKU Discounts (by Product Category)","showDescription":true,"description":"; separated list of discount rates by product (i.e. SQL=0.1 means a 10% discount on DBSQL Usage)"}}},"position":{"x":2,"y":63,"width":4,"height":1}},{"widget":{"name":"8a0589c6","queries":[{"name":"main_query","query":{"datasetName":"a4ec3948","fields":[{"name":"CompliantValues","expression":"`CompliantValues`"},{"name":"sum(Dollar_DBUs)","expression":"SUM(`Dollar_DBUs`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"sum(Dollar_DBUs)","scale":{"type":"quantitative"},"axis":{"title":"Usage ($ DBUs)"},"displayName":"Usage (DBUs)"},"y":{"fieldName":"CompliantValues","scale":{"type":"categorical","sort":{"by":"x-reversed"}},"displayName":"CompliantValues"},"color":{"fieldName":"CompliantValues","scale":{"type":"categorical","mappings":[{"value":"","color":"#919191"},{"value":"demo_project","color":"#1461df"}]},"legend":{"title":"Tag Key Values (values of all tag keys in policy)"},"displayName":"Tag Keys"}},"frame":{"showTitle":true,"title":"Usage By Tag Values"}}},"position":{"x":0,"y":70,"width":6,"height":7}}]}]}